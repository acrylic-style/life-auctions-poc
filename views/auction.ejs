<!DOCTYPE html>
<html>
  <%- include('header', {title: `Auction details`, script: 'auction-script'}); %>
    <meta name="theme-color" content="#000000" />
    <meta id="meta_title" name="title" content="<%= data.stripped_display_name %>" />
    <meta id="meta_description" name="description" content="<%= data.stripped_display_name %> (x<%= data.item_data.Count.value %>) : <%= data.price.toLocaleString() %>円

<%= data.stripped_item_lore %> " />
  </head>
  <body style="background-color: #101010; color: white;">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/94/three.min.js" integrity="sha256-NGC9JEuTWN4GhTj091wctgjzftr+8WNDmw0H8J5YPYE=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/InventivetalentDev/MineRender@1.4.6/dist/model.min.js"></script>
    <script type="text/javascript">
      function convertColorCode(s) {
        if (s == null) return s
        s = s.replace(/\u00A70\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #000;"><b>$1</b></span>');
        s = s.replace(/\u00A71\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #00a;"><b>$1</b></span>');
        s = s.replace(/\u00A72\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #0a0;"><b>$1</b></span>');
        s = s.replace(/\u00A73\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #0aa;"><b>$1</b></span>');
        s = s.replace(/\u00A74\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #a00;"><b>$1</b></span>');
        s = s.replace(/\u00A75\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #a0a;"><b>$1</b></span>');
        s = s.replace(/\u00A76\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #fa0;"><b>$1</b></span>');
        s = s.replace(/\u00A77\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #aaa;"><b>$1</b></span>');
        s = s.replace(/\u00A78\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #555;"><b>$1</b></span>');
        s = s.replace(/\u00A79\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #55f;"><b>$1</b></span>');
        s = s.replace(/\u00A7a\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #5f5;"><b>$1</b></span>');
        s = s.replace(/\u00A7b\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #5ff;"><b>$1</b></span>');
        s = s.replace(/\u00A7c\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #f55;"><b>$1</b></span>');
        s = s.replace(/\u00A7d\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #f5f;"><b>$1</b></span>');
        s = s.replace(/\u00A7e\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #ff5;"><b>$1</b></span>');
        s = s.replace(/\u00A7f\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #fff;"><b>$1</b></span>');
        // ---
        s = s.replace(/\u00A70(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #000;">$1</span>');
        s = s.replace(/\u00A71(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #00a;">$1</span>');
        s = s.replace(/\u00A72(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #0a0;">$1</span>');
        s = s.replace(/\u00A73(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #0aa;">$1</span>');
        s = s.replace(/\u00A74(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #a00;">$1</span>');
        s = s.replace(/\u00A75(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #a0a;">$1</span>');
        s = s.replace(/\u00A76(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #fa0;">$1</span>');
        s = s.replace(/\u00A77(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #aaa;">$1</span>');
        s = s.replace(/\u00A78(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #555;">$1</span>');
        s = s.replace(/\u00A79(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #55f;">$1</span>');
        s = s.replace(/\u00A7a(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #5f5;">$1</span>');
        s = s.replace(/\u00A7b(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #5ff;">$1</span>');
        s = s.replace(/\u00A7c(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #f55;">$1</span>');
        s = s.replace(/\u00A7d(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #f5f;">$1</span>');
        s = s.replace(/\u00A7e(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #ff5;">$1</span>');
        s = s.replace(/\u00A7f(.*?)(?=\u00A7|\n|$)/igm, '<span style="color: #fff;">$1</span>');
        s = s.replace(/\u00A7k(.*?)(?=\u00A7|\n|$)/igm, '$1');
        s = s.replace(/\u00A7l(.*?)(?=\u00A7|\n|$)/igm, '<b>$1</b>');
        s = s.replace(/\u00A7m(.*?)(?=\u00A7|\n|$)/igm, '<strike>$1</strike>');
        s = s.replace(/\u00A7n(.*?)(?=\u00A7|\n|$)/igm, '<u>$1</u>');
        s = s.replace(/\u00A7o(.*?)(?=\u00A7|\n|$)/igm, '<i>$1</i>');
        s = s.replace(/\u00A7r(.*?)(?=\u00A7|\n|$)/igm, '$1');
        return s;
      }
    </script>
    <nav>
      <div class="nav-wrapper">
        <a href="/" class="brand-logo left" style="margin-left: 3%">/ah</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li style='font-size: 10px;'>This website is just a Proof of concept. Use at your own risk.</li>
        </ul>
      </div>
    </nav>
    <br />
    <div class="row container">
      <div class="row" style="background-color: #1e1e1e; border: 3px solid #000;">
        <div class="row left" style="background-color: #121416; border: 3px solid #000; margin-left: 5px; margin-right: 2px; margin-top: 5px; margin-bottom: 5px; width: 40%; min-height: 300px;">
          <div id="itemContainer"></div>
          <div id="itemName" style="font-size: 25px"></div>
          <div id="description"></div>
        </div>
        <div class="container row col right" style="background-color: #121416; border: 3px solid #000; margin-left: 2px; margin-right: 5px; margin-top: 5px; margin-bottom: 5px; min-height: 300px; width: 58%;">
          <span style="font-size: 17px; color: #5c5;">価格</span>
          <br>
          <span style="font-size: 25px; color: #f55;"><%= data.price.toLocaleString() %>円</span>
          <br>
          <span style="font-size: 17px; color: #5c5;">アイテムの数</span>
          <br>
          <span style="font-size: 25px; color: #f55;"><%= data.item_data.Count.value %></span>
          <br>
          <span style="font-size: 17px; color: #5c5;">平均価格</span>
          <br>
          <span style="font-size: 25px; color: #f55;">1個=<%= avgPrice.toLocaleString() %>円</span>
          <br>
          <span style="font-size: 25px; color: #f55;"><%= data.item_data.Count.value %>個=<%= (avgPrice * data.item_data.Count.value).toLocaleString() %>円</span>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      document.getElementById("itemName").innerHTML = convertColorCode(auction.item_name)
      let lore = auction.item_lore
      if (lore) lore = lore.replaceAll('\n', '<br>')
      document.getElementById("description").innerHTML = convertColorCode(lore)
      const customModelData = parseInt('<%= data.item_data.tag?.value?.CustomModelData?.value %>');
      const useVanillaTexture = customModelData === 0 || isNaN(customModelData)
      !(async () => {
        if (!useVanillaTexture) {
          try {
            const root = 'https://raw.githubusercontent.com/azisaba/resourcepacks/main/life'
            const originalModelPath = '/assets/minecraft/models/item/<%= item_id.replace("minecraft:", "") %>.json'
            const originalModel = await fetch(root + originalModelPath).then(res => res.json())
            if (!originalModel.overrides) {
              throw new Error('No overrides found, skipping')
            }
            const customModelName = originalModel.overrides.find(e => e.predicate?.custom_model_data === customModelData).model
            const customModelPath = `/assets/minecraft/models/${customModelName}.json`
            const customModel = await fetch(root + customModelPath).then(res => res.json())
            const customModelTexture = customModel.textures[Object.keys(customModel.textures)[0]]
            const tag = document.createElement('div')
            tag.style.backgroundImage = `url("${root}/assets/minecraft/textures/${customModelTexture}.png")`
            tag.style.width = '64px'
            tag.style.height = '64px'
            tag.style.backgroundRepeat = 'no-repeat'
            tag.style.backgroundPosition = '0 0'
            tag.style.backgroundSize = 'cover'
            document.getElementById('itemContainer').appendChild(tag)
            return
          } catch (e) {
            console.warn(e)
          }
        }
        const modelRender = new ModelRender({
          centerCubes: true,
          assetRoot: "https://assets.mcasset.cloud/1.15.2",
          canvas: {
            width: 256,
            height: 256,
          },/*
          camera: {
            x: 0,
            y: 0,
            z: 0,
            target: [0, 0, 0],
          },*/
          autoResize: false,
        }, document.getElementById("itemContainer"));
        modelRender.render(["item/<%= item_id.replace('minecraft:', '') %>"])
      })()
    </script>
  </body>
</html>